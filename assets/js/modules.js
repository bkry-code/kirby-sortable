!function(e){function t(i){if(s[i])return s[i].exports;var n=s[i]={exports:{},id:i,loaded:!1};return e[i].call(n.exports,n,n.exports,t),n.loaded=!0,n.exports}var s={};return t.m=e,t.c=s,t.p="",t(0)}([function(e,t,s){"use strict";function i(e){return e&&e.__esModule?e:{default:e}}function n(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}var o=function(){function e(e,t){for(var s=0;s<t.length;s++){var i=t[s];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(e,i.key,i)}}return function(t,s,i){return s&&e(t.prototype,s),i&&e(t,i),t}}(),r=s(1),a=i(r);!function(e){var t=new a.default,s=!1,i=!1,r=function(){function r(s){var i=this;n(this,r),this.element=e(s),this.modules=e(".module",s),this.api=this.element.data("api"),t.collection=this.modules,t.recall(),this.element._sortable({handle:".module__preview, .module__title",start:function(s,n){i.element._sortable("refreshPositions"),t.add(e(n.item),!0),i.blur()}}),this.events()}return o(r,[{key:"blur",value:function(){e(".form input:focus, .form select:focus, .form textarea:focus").blur(),app.content.focus.forget()}},{key:"events",value:function(){var n=this,o=this;this.element.on("_sortableupdate",function(e,t){var s=n.element.children().index(t.item),i=t.item.data("uid");n.sort(i,s)}),this.element.on("click","[data-action]",function(t){t.preventDefault(),e.post(e(this).data("action"),o.reload.bind(o))}),this.modules.on("click",function(t){n.select(e(t.delegateTarget))}),e(document).off(".modules").on("keydown.modules",function(o){switch(o.keyCode){case 16:if(s)return!0;s=!0;break;case 17:if(i)return!0;i=!0;break;case 67:if(!o.metaKey&&!o.ctrlKey)return!0;var r=t.selected();r.length&&e.post("http://www.kirby.dev/panel/pages/home/field/modules/modules/copy",{modules:r},n.reload.bind(n));break;case 86:if(!o.metaKey&&!o.ctrlKey)return!0;n.modules.hasClass("is-selected")&&app.modal.open("http://www.kirby.dev/panel/pages/home/field/modules/modules/paste")}}).on("keyup.modules",function(e){switch(e.keyCode){case 16:s=!1;break;case 17:i=!1}}).on("click.modules",function(s){e(s.target).closest(".module").length||t.reset()}),t.on("change",function(e){console.log(e)})}},{key:"select",value:function(n){this.blur(),n=e(n),s&&i||s||(i?t.toggle(n):t.add(n,!0))}},{key:"sort",value:function(t,s){this.disable(),e.post(this.api+"/sort",{uid:t,to:s+1},this.reload.bind(this))}},{key:"disable",value:function(){this.element._sortable("disable")}},{key:"reload",value:function(){this.disable(),app.content.reload()}}]),r}();e.widget("ui._sortable",e.ui.sortable,{_mouseStart:function(t,s,i){var n,o,r=this.options;if(this.currentContainer=this,this.refreshPositions(),this.helper=this._createHelper(t),this._cacheHelperProportions(),this._cacheMargins(),this.scrollParent=this.helper.scrollParent(),this.offset=this.currentItem.offset(),this.offset={top:this.offset.top-this.margins.top,left:this.offset.left-this.margins.left},e.extend(this.offset,{click:{left:t.pageX-this.offset.left,top:t.pageY-this.offset.top},parent:this._getParentOffset(),relative:this._getRelativeOffset()}),this._createPlaceholder(),this.helper.css("position","absolute"),this.cssPosition=this.helper.css("position"),this.originalPosition=this._generatePosition(t),this.originalPageX=t.pageX,this.originalPageY=t.pageY,r.cursorAt&&this._adjustOffsetFromHelper(r.cursorAt),this.domPosition={prev:this.currentItem.prev()[0],parent:this.currentItem.parent()[0]},this.helper[0]!==this.currentItem[0]&&this.currentItem.hide(),r.containment&&this._setContainment(),r.cursor&&"auto"!==r.cursor&&(o=this.document.find("body"),this.storedCursor=o.css("cursor"),o.css("cursor",r.cursor),this.storedStylesheet=e("<style>*{ cursor: "+r.cursor+" !important; }</style>").appendTo(o)),r.opacity&&(this.helper.css("opacity")&&(this._storedOpacity=this.helper.css("opacity")),this.helper.css("opacity",r.opacity)),r.zIndex&&(this.helper.css("zIndex")&&(this._storedZIndex=this.helper.css("zIndex")),this.helper.css("zIndex",r.zIndex)),this.scrollParent[0]!==document&&"HTML"!==this.scrollParent[0].tagName&&(this.overflowOffset=this.scrollParent.offset()),this._trigger("start",t,this._uiHash()),this._preserveHelperProportions||this._cacheHelperProportions(),!i)for(n=this.containers.length-1;n>=0;n--)this.containers[n]._trigger("activate",t,this._uiHash(this));return e.ui.ddmanager&&(e.ui.ddmanager.current=this),e.ui.ddmanager&&!r.dropBehaviour&&e.ui.ddmanager.prepareOffsets(this,t),this.dragging=!0,this.helper.addClass("ui-sortable-helper"),this._mouseDrag(t),!0}}),e.fn.modules=function(){return this.each(function(){if(e(this).data("modules"))return e(this);var t=new r(this);return e(this).data("modules",t),e(this)})}}(jQuery)},function(e,t){"use strict";function s(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}Object.defineProperty(t,"__esModule",{value:!0});var i=function(){function e(e,t){for(var s=0;s<t.length;s++){var i=t[s];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(e,i.key,i)}}return function(t,s,i){return s&&e(t.prototype,s),i&&e(t,i),t}}(),n=function(){function e(){s(this,e),this.collection={},this.selection=[],this.events={},this.options={class:"is-selected",data:"uid"}}return i(e,[{key:"index",value:function(e){return this.selection.indexOf(e)}},{key:"add",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]&&arguments[1],s=e.data(this.options.data);t&&this.reset(),this.index(s)===-1&&(e.addClass(this.options.class),this.selection.push(s),this.trigger("change",this.selection))}},{key:"remove",value:function(e){var t=this.index(e.data(this.options.data));t!==-1&&(e.removeClass(this.options.class),this.selection.splice(t,1),this.trigger("change",this.selection))}},{key:"toggle",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]&&arguments[1];this.index(e.data(this.options.data))===-1?this.add(e,t):this.remove(e)}},{key:"selected",value:function(){var e=this,t=[];return this.collection.each(function(s,i){var n=$(i).data(e.options.data);e.index(n)!==-1&&t.push(n)}),t}},{key:"recall",value:function(){var e=this;this.selection.length&&this.collection.filter(function(t,s){return e.index($(s).data(e.options.data))!==-1}).addClass(this.options.class)}},{key:"reset",value:function(){this.collection.removeClass(this.options.class),this.selection=[]}},{key:"on",value:function(e,t){this.events[e]=this.events[e]||[],this.events[e].push(t)}},{key:"off",value:function(e,t){e in this.events!=!1&&this.events[e].splice(this.events[e].indexOf(t),1)}},{key:"trigger",value:function(e){if(e in this.events!=!1)for(var t=0;t<this.events[e].length;t++)this.events[e][t].apply(this,Array.prototype.slice.call(arguments,1))}}]),e}();t.default=n}]);